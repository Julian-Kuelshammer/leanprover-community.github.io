<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="https://leanprover-community.github.io//css/lean.css" >
  <link rel="shortcut icon" href="https://leanprover-community.github.io//img/favicon.ico">
  <link rel="search" type="application/opensearchdescription+xml" title="mathlib docs" href="https://leanprover-community.github.io//opensearch.xml">
  <link href="https://fonts.googleapis.com/css2?family=Merriweather&family=Open+Sans&family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet">
    

	<script>
                function buildShortcutsForStructures(names) {
                        const o = {}
                        names.forEach(name => o[name] = `\\mathbb\{${name}\}`)
                        return o
                }
		MathJax = {
			  tex: {
                                  macros: {
                                          ...buildShortcutsForStructures(["R", "Q", "Z", "N", "C"]),
                                  },
				      inlineMath: [['$', '$'], ['\\(', '\\)']]
				    },
		};
	</script>
	<script type="text/javascript" id="MathJax-script" async
		  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
	</script>

	<title>The Lean Github ecosystem</title>
  </head>
  <body>
  <nav class="navbar navbar-expand-lg navbar-light bg-gradient-light d-md-none">
    <div class="d-flex flex-grow-1">
		<a class="navbar-brand" href="https://leanprover-community.github.io/index.html">Lean Community
    </a>
    </div>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
  </nav>

<div id="mainbox">

  <main>
    
<h1 id="the-lean-github-ecosystem" class="markdown-heading">The Lean Github ecosystem <a class="hover-link" href="#the-lean-github-ecosystem">#</a></h1>
<p>Documentation of the branches, tags, and CI workflows relevant for making PRs to Lean, Std, and
Mathlib.</p>
<ul>
<li><a href="#things-you-need-to-know">Things you need to know</a> is relevant for everyone</li>
<li><a href="#tags-and-branches">Tags and branches</a> is for &quot;experts only&quot; who are making or fixing
breaking changes in Lean, or who want to understand the inner workings of Mathlib CI.</li>
</ul>
<h2 id="things-you-need-to-know" class="markdown-heading">Things you need to know <a class="hover-link" href="#things-you-need-to-know">#</a></h2>
<ul>
<li>
<p>If you are making a PR to <code>leanprover/lean4</code> which may involve breaking changes,
please rebase your PR onto the <code>nightly</code> branch. This will enable combined CI with Mathlib.</p>
</li>
<li>
<p>If you are making a PR to <code>leanprover-community/mathlib4</code>,
please ask for &quot;write&quot; access to the repository via the <a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/github.20permission">zulip chat</a>, and push your branch to that repo.
This will enable Mathlib's <code>.olean</code> cache to include your PR.</p>
</li>
</ul>
<h2 id="tags-and-branches" class="markdown-heading">Tags and branches <a class="hover-link" href="#tags-and-branches">#</a></h2>
<h3 id="leanproverlean4" class="markdown-heading"><code>leanprover/lean4</code> <a class="hover-link" href="#leanproverlean4">#</a></h3>
<ul>
<li>Development occurs on the <code>master</code> branch.</li>
<li>Stable releases and release candidates have tags, e.g. <code>v4.2.0</code> or <code>v4.3.0-rc1</code>.
<ul>
<li>To use these, your <code>lean-toolchain</code> should contain e.g. <code>leanprover/lean4:v4.2.0</code>.</li>
</ul>
</li>
<li>Stable releases arrive at the end of each month, and are identical to the last release candidate.</li>
<li>The first release candidate of the next version is released immediately after the stable release.</li>
<li>Each version has a <code>releases/v4.X.0</code> feature branch, which may contain
<ul>
<li>additional commits for release notes</li>
<li>cherry picked commits from <code>master</code> for critical fixes released via release candidates.</li>
</ul>
</li>
<li>We make a regular nightly release from <code>master</code>, which has a tag e.g. <code>nightly-2023-11-01</code> on the
<code>leanprover/lean4-nightly</code> repository.
<ul>
<li>To use these, your <code>lean-toolchain</code> should contain e.g. <code>leanprover/lean4:nightly-2023-11-01</code>.</li>
</ul>
</li>
<li>There is a <code>nightly</code> branch on <code>leanprover/lean4</code> which follows the most recent commit which was
used to construct a nightly release.</li>
<li>Every PR automatically receives a toolchain. For PR #NNNN, your <code>lean-toolchain</code> should contain
<code>leanprover/lean4-pr-releases:pr-release-NNNN</code>.</li>
</ul>
<h3 id="leanproverstd4-aka-std" class="markdown-heading"><code>leanprover/std4</code> (aka 'Std') <a class="hover-link" href="#leanproverstd4-aka-std">#</a></h3>
<ul>
<li>Development occurs on <code>main</code>.</li>
<li>Std uses the latest stable release or release candidate in its <code>lean-toolchain</code>.
<ul>
<li>Because we release <code>v4.3.0-rc1</code> immediately after releasing <code>v4.2.0</code>, Std is only very briefly
on stable releases.</li>
</ul>
</li>
<li>The first commit on <code>main</code> which uses a new toolchain is tagged with the version number of that
toolchain (e.g. <code>v4.2.0</code>).</li>
<li>There is a branch <code>stable</code> which follows the <code>v4.X.0</code> tags.</li>
<li>Std has a branch <code>bump/v4.X.0</code> for the upcoming stable version,
<ul>
<li>which contains adaptations for breaking changes that have been approved by the maintainers</li>
<li>and which will be using a <code>leanprover-lean4:nightly-YYYY-MM-DD</code> toolchain.</li>
</ul>
</li>
<li>Std has a branch <code>nightly-testing</code> which
<ul>
<li>uses a recently nightly release (this is updated automatically)</li>
<li>has all commits from <code>main</code> merged into it automatically</li>
<li>may have any changes from <code>bump/v4.X.0</code> merged into it manually</li>
<li>may have any other commits, including unreviewed ones, required to keep the <code>nightly-testing</code>
branch working again recent nightly releases.</li>
</ul>
</li>
<li>Failures in CI on the <code>nightly-testing</code> are reported by a bot to zulip in the private
&quot;Mathlib reviewers&quot; stream.</li>
<li>Success in CI on the <code>nightly-testing</code> branch results in the creation or updating of a branch
<code>nightly-testing-YYYY-MM-DD</code> to match that commit.
<ul>
<li>Thus if <code>nightly-testing-YYYY-MM-DD</code> exists, we know that:
<ul>
<li>the <code>lean-toolchain</code> is <code>leanprover/lean4:nightly-YYYY-MM-DD</code>, and</li>
<li>CI succeeds.</li>
</ul>
</li>
</ul>
</li>
<li>When changes are required to Std to adapt to a breaking change in Lean,
please open a PR.
<ul>
<li>Typically, if the change was made in <code>leanprover/lean4#NNNN</code>,
this PR should be from a branch named <code>lean-pr-testing-NNNN</code>,
and <code>lean-toolchain</code> will contain <code>leanprover/lean4-pr-releases:pr-release-NNNN</code>.</li>
<li>This PR should be made against the <code>bump/v4.X.0</code> branch, not against <code>main</code>.</li>
<li>This PR should be labelled <code>v4.X.0</code>, where <code>v4.X.0</code> is the upcoming stable version,
and also labelled 'depends on core changes'.</li>
<li>Once the Lean PR has been merged and published in a nightly release, the Std adaptation PR
<ul>
<li>should have its <code>lean-toolchain</code> updated to <code>leanprover/lean4:nightly-YYYY-MM-DD</code></li>
<li>may be merged into <code>nightly-testing</code> as needed.</li>
</ul>
</li>
<li>Once the Std adaptation PR has been approved, it can be merged to <code>bump/v4.X.0</code>.</li>
</ul>
</li>
<li>It is always allowed to merged <code>bump/v4.X.0</code> into <code>nightly-testing</code>, but not conversely.
(Changes to <code>bump/v4.X.0</code> have been reviewed, but changes to <code>nightly-testing</code> may not be.)</li>
<li>When it is time to update Std to a new Lean release,
<em>hopefully</em> all that is required is to make a new PR
consisting of squash merging <code>bump/v4.X.0</code> to <code>main</code>.</li>
</ul>
<h3 id="leanprover-communitymathilb4-aka-mathlib" class="markdown-heading"><code>leanprover-community/mathilb4</code> (aka 'Mathlib') <a class="hover-link" href="#leanprover-communitymathilb4-aka-mathlib">#</a></h3>
<ul>
<li>Everything said above about Std applies to Mathlib, except:
<ul>
<li>Development occurs on <code>master</code>.</li>
<li>PRs to Mathlib should be made from branches of the Mathlib repository itself.
<ul>
<li>This is required for Mathlib's <code>.olean</code> caching mechanism.</li>
<li>Please ask on the <a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/github.20permission">zulip chat</a> for &quot;write&quot; permission to Mathlib.
Please write a sentence about your background and plans.</li>
</ul>
</li>
</ul>
</li>
<li>Note that the <code>nightly-testing</code> branch of Mathlib may use the <code>nightly-testing</code> branch of Std.</li>
<li>Mathlib adaptation PRs on <code>lean-pr-testing-NNNN</code> branches may need to change the Std dependency
to use a <code>lean-pr-testing-NNNN</code> branch of Std, if Std also experiences breakages.</li>
</ul>
<h3 id="combined-ci-between-lean-and-mathlib" class="markdown-heading">Combined CI between Lean and Mathlib <a class="hover-link" href="#combined-ci-between-lean-and-mathlib">#</a></h3>
<ul>
<li>For every PR to Lean, we attempt to run Mathlib CI against the resulting toolchain.</li>
<li>For this to work, you will need to rebase your PR onto the <code>nightly</code> branch.
<ul>
<li>If you have not done this, a bot will comment saying that it can not run Mathlib CI,
and advising that if you need this you will need to rebase your PR onto <code>nightly</code>.</li>
</ul>
</li>
<li>Further, the latest nightly release may or may not have a corresponding
<code>nightly-testing-YYYY-MM-DD</code> branch on Std and Mathlib (see above).
<ul>
<li>If this branch does not yet exist, a bot will comment on your PR notifying you
that it can not run Mathlib CI, and advising that it will try again when you either
<ul>
<li>push more commits, or</li>
<li>rebase your PR onto a future update of the <code>nightly</code> branch
(note that this may be necessary if Mathlib is having persistent problems adapting
to the most recent nightly release).</li>
</ul>
</li>
<li>If this branch does exist, then the bot will automatically create a
<code>lean-pr-testing-NNNN</code> branch at Mathlib from the <code>nightly-testing-YYYY-MM-DD</code> branch,
and set the toolchain to <code>leanprover/lean4-pr-releases:pr-release-NNNN</code>.
<ul>
<li>Subsequent CI results from that Mathlib branch will be reported back to the Lean PR
in the form of comments.</li>
</ul>
</li>
</ul>
</li>
</ul>

  </main>

    <nav id="navbar" class="d-md-block bg-light sidebar collapse navbar-light pb-4">
      <div class="d-none d-md-block mt-4"><a class="navbar-brand" href="https://leanprover-community.github.io/index.html">Lean Community</a></div>
      
        <h6 class="sidebar-heading mt-4">Community</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover.zulipchat.com/">Zulip chat</a></li>
        
          <li class="nav-item col-12"><a href="https://github.com/leanprover-community/mathlib4">GitHub</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/blog">Blog</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/meet.html">Community information</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/teams.html">Teams</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/papers.html">Papers about Lean</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/lean_projects.html">Projects using Lean</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/teaching/index.html">Teaching using Lean</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/events.html">Events</a></li>
        </ul>
      
        <h6 class="sidebar-heading mt-4">Installation</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/get_started.html">Get started</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/install/debian.html">Debian/Ubuntu installation</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/install/linux.html">Generic Linux installation</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/install/macos.html">MacOS installation</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/install/windows.html">Windows installation</a></li>
        
          <li class="nav-item col-12"><a href="https://live.lean-lang.org/">Online version (no installation)</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/install/project.html">Using Lake (build system)</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/toolchain.html">The Lean toolchain</a></li>
        </ul>
      
        <h6 class="sidebar-heading mt-4">Documentation</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/learn.html">Learning resources (start here)</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/mathlib4_docs">API documentation</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/extras/calc.html">Calc mode</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/extras/conv.html">Conv mode</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/extras/simp.html">Simplifier</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/extras/well_founded_recursion.html">Well-founded recursion</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/mwe.html">About MWEs</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/glossary.html">Glossary</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/tips_and_tricks.html">Tips and tricks</a></li>
        </ul>
      
        <h6 class="sidebar-heading mt-4">Library overviews</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/mathlib-overview.html">Library overview</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/undergrad.html">Undergraduate maths</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/100.html">Wiedijk's 100 theorems</a></li>
        </ul>
      
        <h6 class="sidebar-heading mt-4">Contributing</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/contribute/index.html">Pull request lifecycle</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/contribute/naming.html">Naming conventions</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/contribute/style.html">Code style guideline</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/contribute/doc.html">Documentation style</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/contribute/commit.html">Commit conventions</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/contribute/pr-review.html">Pull request review guide</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/ci.html">CI for 3rd party projects</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/mathlib_stats.html">Contribution statistics</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/contribute/tags_and_branches.html">Tags and branches</a></li>
        </ul>
      
    </nav>

</div>


  <nav class="footer navbar navbar-expand-lg navbar-light bg-light justify-content-end">
  <ul class="nav">
    <li class="nav-item">
      <a class="nav-link active" href="https://github.com/leanprover-community/leanprover-community.github.io/blob/lean4/templates/contribute/tags_and_branches.md">Suggest edits to this page on GitHub</a>
    </li>
  </ul>
  </nav>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"></script>
    <script src="https://leanprover-community.github.io//js/bootstrap.min.js"></script>
    
  </body>
</html>
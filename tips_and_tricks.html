<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="https://leanprover-community.github.io//css/lean.css" >
  <link rel="shortcut icon" href="https://leanprover-community.github.io//img/favicon.ico">
  <link rel="search" type="application/opensearchdescription+xml" title="mathlib docs" href="https://leanprover-community.github.io//opensearch.xml">
<link href="https://fonts.googleapis.com/css2?family=Merriweather&family=Open+Sans&family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet">
    

	<script>
                function buildShortcutsForStructures(names) {
                        const o = {}
                        names.forEach(name => o[name] = `\\mathbb\{${name}\}`)
                        return o
                }
		MathJax = {
			  tex: {
                                  macros: {
                                          ...buildShortcutsForStructures(["R", "Q", "Z", "N", "C"]),
                                  },
				      inlineMath: [['$', '$'], ['\\(', '\\)']]
				    },
		};
	</script>
	<script type="text/javascript" id="MathJax-script" async
		  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
	</script>

	<title>Lean Tips and Tricks</title>
  </head>
  <body>
  <nav class="navbar navbar-expand-lg navbar-light bg-gradient-light d-md-none">
    <div class="d-flex flex-grow-1">
		<a class="navbar-brand" href="https://leanprover-community.github.io/index.html">Lean Community
    </a>
    </div>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
  </nav>

<div id="mainbox">

  <main>
    
<div class="alert alert-info">
<p>
We are currently updating the Lean community website to describe working with Lean 4,
but most of the information you will find here today still describes Lean 3.
</p>
<p>
Pull requests updating this page for Lean 4 are very welcome.
There is a link at the bottom of this page.
</p>
<p>
Please visit <a href="https://leanprover.zulipchat.com">the leanprover zulip</a>
and ask for whatever help you need during this transitional period!
</p>
<p>
The website for Lean 3 has been <a href="https://leanprover-community.github.io/lean3/">archived</a>.
If you need to link to Lean 3 specific resources please link there.
</p>
</div>
<h1 id="lean-tips-and-tricks" class="markdown-heading">Lean Tips and Tricks <a class="hover-link" href="#lean-tips-and-tricks">#</a></h1>
<p>This document contains some tips for intermediate and advanced users of Lean.
It is currently focussed around Lean 3.</p>
<h3 id="commenting-out-large-proofs-using-sorry" class="markdown-heading">Commenting out large proofs using <code>sorry</code> <a class="hover-link" href="#commenting-out-large-proofs-using-sorry">#</a></h3>
<p>Sometimes skipping subportions of a proof is helpful (e.g. to disable a portion which is slow while working on the rest). The straightforward way to do so is to comment out the lines which constitute the subportion, but if a subgoal has been surrounded by braces, you can also temporarily skip it by prepending <code>sorry;</code></p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code><span class="gr">sorry</span><span class="bp">;</span> <span class="o">{</span> <span class="n">rw</span> <span class="n">blah</span><span class="o">,</span>
  <span class="bp">...</span>
  <span class="n">HUGE</span> <span class="n">PROOF</span><span class="o">,</span>
  <span class="bp">...</span> <span class="o">}</span>
</code></pre></div>
</div>

<p>With this method only one line needs to be changed, syntax highlighting is usually preserved, and jumping to definition still works. It also has the advantage that it is extremely easy to remove all instances of <code>sorry;</code> from a file when finished using find and replace, and to quickly toggle this on and off to check things still work when desired.</p>
<h3 id="memory-and-deterministic-timeout" class="markdown-heading">Memory and deterministic timeout <a class="hover-link" href="#memory-and-deterministic-timeout">#</a></h3>
<p>Lean has two configurable flags for configuring its resource usage, memory and execution time.
While the defaults for these are usually fairly sensible, when writing proofs it can be helpful to increase these options, if deterministic timeouts or out of memory issues slow down development.
This is especially helpful when using tactics like <a href="/mathlib_docs/tactics.html#library_search"><code>library_search</code></a>, which may run for a long time but then produce a result that tells us a much faster tactic to use if they succeed.</p>
<p>To change these settings we can add the flags <code>-M &lt;some number of megabytes&gt;</code> (default 4096) for the memory limit and <code>-T &lt;number of allocations&gt;</code> (default 100000).
In VSCode this can be configured by opening the settings (<code>ctrl+,</code>) and searching for <code>Lean Memory Limit</code> and <code>Lean Time Limit</code>.
Mathlib itself enforces a deterministic timeout of 100000, and often tries to have individual tactic calls use much less, so it is good practice not to rely on a large value for this setting.</p>
<h3 id="old-mode" class="markdown-heading">Old mode <a class="hover-link" href="#old-mode">#</a></h3>
<p>If you change a file early on in the import hierarchy and then attempt to work on a file that depends on it much later, then Lean will try to check all files in between to ensure they didn't break.
This behaviour can cause the Lean server to become unresponsive, or simply slow down development.
You can call lean with the &quot;--old&quot; flag to help in these situations, though it does come with some caveats.
In VSCode you can enable it by opening the VSCode settings and searching for &quot;Lean: extra options&quot; then add the flag <code>--old</code>.
For Emacs the variable <code>lean-extra-arguments</code> can be modified to add this flag.
This causes lean not to recompile oleans for unedited files and just assume everything worked, so in this situation it is helpful to avoid recompilation.
However you do then run the risk that your change broke or changed the meaning of some file in-between. Thus this suggestion mostly applies when you are adding a new lemma/definition early in the hierarchy that you are sure won't break later files, rather than when you are changing existing definitions in an incompatible way.
It is possible to &quot;prove false&quot; when running lean with the old flag on; by changing a definition in an early file, later results about that definition may become incorrect if Lean is asked not to rebuild those files.
The old flag should therefore not be used when consistency of the whole project is important (e.g. in CI), though it can speed up development.</p>
<h3 id="the-exit-command-and-" class="markdown-heading">The <code>#exit</code> command and <code>.</code> <a class="hover-link" href="#the-exit-command-and-">#</a></h3>
<p>The command <code>#exit</code> will cause lean to stop reading the file at the location it is inserted.
This can be helpful when working on proofs in the middle of a file with many results or slow results below the current location.
This is related to switching to <code>check visible lines</code> mode, but gives the user more precise control over which parts of the file are slow.</p>
<p>Likewise when working at the start of a file Lean will recheck the import lines, this can be prevented by placing a <code>.</code> character (which delimits lean declarations) on a newline after the import lines.
This can also be useful in other situations when Lean wants to recheck things above the lemma or definition you are changing unnecessarily.
Another alternative here is to add a <a href="contribute/doc.html#header-comment">module doc-string</a> after the imports which also has the effect of separating the start of the file from the code.</p>
<h3 id="profiling-proofs" class="markdown-heading">Profiling proofs <a class="hover-link" href="#profiling-proofs">#</a></h3>
<p>Sometimes long proofs are slow to execute and isolating the slow tactic or subgoals in an attempt to refactor or speed them up is necessary.
The basic option to enable this is <code>set_option profiler true</code>, which will print out timing information for tactic execution.
Commenting out subproofs (with the sorry trick above) you can isolate the slow part of the proof and explore options for rewriting it.</p>
<h3 id="avoiding-many-nested-parentheses-with-" class="markdown-heading">Avoiding many nested parentheses with <code>$</code> <a class="hover-link" href="#avoiding-many-nested-parentheses-with-">#</a></h3>
<p>Lean is a functional language that uses parentheses <code>(..)</code> as the basic tool for grouping terms together that should be evaluated first.
In the following lemma we have to use 5 sets of nested parentheses in order to tell Lean we want to repeatedly apply <code>or.inl</code> and <code>or.inr</code>, each of these only take one argument so the bracketing starts to feel a bit excessive.</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code><span class="kd">lemma</span> <span class="n">many_ors</span> <span class="o">:</span> <span class="n">false</span> <span class="bp">∨</span> <span class="n">false</span> <span class="bp">∨</span> <span class="n">false</span> <span class="bp">∨</span> <span class="n">false</span> <span class="bp">∨</span> <span class="n">false</span> <span class="bp">∨</span> <span class="n">true</span> <span class="bp">∨</span> <span class="n">false</span> <span class="o">:=</span>
<span class="n">or.inr</span> <span class="o">(</span><span class="n">or.inr</span> <span class="o">(</span><span class="n">or.inr</span> <span class="o">(</span><span class="n">or.inr</span> <span class="o">(</span><span class="n">or.inr</span> <span class="o">(</span><span class="n">or.inl</span> <span class="n">trivial</span><span class="o">)))))</span>
</code></pre></div>
</div>

<p>Such proofs take up a lot of unnecessary space, and the parenthesis do not aid understanding when the function being applied only has one argument. Additionally, manually inserting the right amount of parentheses is tricky, and sometimes results in annoying to find errors.
The <code>$</code> symbol may be used in this situation to give a cleaner looking proof.
This symbol can be thought of as inserting a left parenthesis at the point of the <code>$</code> and then adding a closing right parenthesis as far right as possible.
In this case its use looks like</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code><span class="kd">lemma</span> <span class="n">many_ors</span> <span class="o">:</span> <span class="n">false</span> <span class="bp">∨</span> <span class="n">false</span> <span class="bp">∨</span> <span class="n">false</span> <span class="bp">∨</span> <span class="n">false</span> <span class="bp">∨</span> <span class="n">false</span> <span class="bp">∨</span> <span class="n">true</span> <span class="bp">∨</span> <span class="n">false</span> <span class="o">:=</span>
<span class="n">or.inr</span> <span class="bp">$</span> <span class="n">or.inr</span> <span class="bp">$</span> <span class="n">or.inr</span> <span class="bp">$</span> <span class="n">or.inr</span> <span class="bp">$</span> <span class="n">or.inr</span> <span class="bp">$</span> <span class="n">or.inl</span> <span class="n">trivial</span>
</code></pre></div>
</div>

<p>By as far right as possible we mean that in the following example</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code><span class="n">some_function</span> <span class="o">(</span><span class="n">a</span> <span class="bp">$</span> <span class="n">really</span> <span class="bp">$</span> <span class="n">long</span> <span class="bp">$</span> <span class="n">chain</span> <span class="bp">$</span> <span class="n">of</span> <span class="bp">$</span> <span class="n">applications</span><span class="o">)</span> <span class="n">another_argument</span>
</code></pre></div>
</div>

<p>lean evaluates as <code>some_function (a (really (long (chain (of applications))))) another_argument</code> together as intended, as the outer set of brackets still limits the scope of the <code>$</code> symbol.
If we were to remove the parentheses here, Lean would interpret <code>another_argument</code> as an argument to <code>applications</code> rather than to <code>some_function</code>.</p>
<p>In the first example another even more succinct explicit term mode proof is possible via the use of dot notation.</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code><span class="kd">lemma</span> <span class="n">many_ors</span> <span class="o">:</span> <span class="n">false</span> <span class="bp">∨</span> <span class="n">false</span> <span class="bp">∨</span> <span class="n">false</span> <span class="bp">∨</span> <span class="n">false</span> <span class="bp">∨</span> <span class="n">false</span> <span class="bp">∨</span> <span class="n">true</span> <span class="bp">∨</span> <span class="n">false</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">or.inl</span> <span class="n">trivial</span><span class="o">)</span><span class="bp">.</span><span class="n">inr.inr.inr.inr.inr</span>
</code></pre></div>
</div>

<p>Here <code>(...).inr</code> causes Lean to look at the type of the bracketed term, find that it is of the form <code>or _ _</code>, and therefore expand this into <code>or.inr (...)</code>, as this function is in the <code>or</code> namespace.
All steps in this proof are nested <code>or</code>s therefore we can repeatedly use dot notation to write this proof.</p>
<p>This style is used often in mathlib to write nested function applications when the namespaces allow for a lot of information to be inferred by Lean.
For instance if we want to say that 7 times the square of a continuous real-valued function is continuous we can use dot notation to give a very short but still readable proof:</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code><span class="kd">lemma</span> <span class="n">a</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">ℝ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">continuous</span> <span class="n">f</span><span class="o">)</span> <span class="o">:</span> <span class="n">continuous</span> <span class="o">(</span><span class="mi">7</span> <span class="bp">•</span> <span class="n">f</span> <span class="bp">^</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">hf.pow</span> <span class="mi">2</span><span class="o">)</span><span class="bp">.</span><span class="n">nsmul</span> <span class="mi">7</span>
</code></pre></div>
</div>

<p>rather than</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code><span class="n">continuous.nsmul</span> <span class="o">(</span><span class="n">continuous.pow</span> <span class="n">hf</span> <span class="mi">2</span><span class="o">)</span> <span class="mi">7</span>
</code></pre></div>
</div>

<p>Using dot notation allows us to refer to namespaced declarations succinctly without having to open all namespaces (and thus run the risk of overridden names).</p>
<h3 id="finding-instance-names" class="markdown-heading">Finding instance names <a class="hover-link" href="#finding-instance-names">#</a></h3>
<p>When instances are unnamed Lean will attempt to automatically name them.
If you have just written an instance and want to check the name Lean has given it, the quickest way is to use <code>#print instances</code>.
The command <code>#print instances my_class</code> will show all instances of <code>my_class</code> with the most recently declared last.</p>

  </main>

    <nav id="navbar" class="d-md-block bg-light sidebar collapse navbar-light pb-4">
      <div class="d-none d-md-block mt-4"><a class="navbar-brand" href="https://leanprover-community.github.io/index.html">Lean Community</a></div>
      
        <h6 class="sidebar-heading mt-4">Community</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover.zulipchat.com/">Zulip chat</a></li>
        
          <li class="nav-item col-12"><a href="https://github.com/leanprover-community/mathlib4">GitHub</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/blog">Blog</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/meet.html">Community information</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/teams.html">Teams</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/papers.html">Papers about Lean</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/lean_projects.html">Projects using Lean</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/events.html">Events</a></li>
        </ul>
      
        <h6 class="sidebar-heading mt-4">Installation</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/get_started.html">Get started</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/install/debian.html">Debian/Ubuntu installation</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/install/linux.html">Generic Linux installation</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/install/macos.html">MacOS installation</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/install/windows.html">Windows installation</a></li>
        
          <li class="nav-item col-12"><a href="https://lean.math.hhu.de/">Online version (no installation)</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/leanproject.html">Using leanproject</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/toolchain.html">The Lean toolchain</a></li>
        </ul>
      
        <h6 class="sidebar-heading mt-4">Documentation</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/learn.html">Learning resources (start here)</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/mathlib4_docs">API documentation</a></li>
        
          <li class="nav-item col-12"><a href="https://mathlib-changelog.vercel.app/">Changelog</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/extras/calc.html">Calc mode</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/extras/conv.html">Conv mode</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/extras/simp.html">Simplifier</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/extras/tactic_writing.html">Tactic writing tutorial</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/extras/well_founded_recursion.html">Well-founded recursion</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/mwe.html">About MWEs</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/glossary.html">Glossary</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/tips_and_tricks.html">Tips and tricks</a></li>
        </ul>
      
        <h6 class="sidebar-heading mt-4">Library overviews</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/mathlib-overview.html">Library overview</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/undergrad.html">Undergraduate maths</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/100.html">Wiedijk's 100 theorems</a></li>
        </ul>
      
        <h6 class="sidebar-heading mt-4">Theory docs</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/theories/category_theory.html">Category theory</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/theories/linear_algebra.html">Linear algebra</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/theories/naturals.html">Natural numbers</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/theories/sets.html">Sets and set-like objects</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/theories/topology.html">Topology</a></li>
        </ul>
      
        <h6 class="sidebar-heading mt-4">Contributing</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/contribute/index.html">Pull request lifecycle</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/contribute/naming.html">Naming conventions</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/contribute/style.html">Code style guideline</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/contribute/doc.html">Documentation style</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/ci.html">CI for 3rd party projects</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/mathlib_stats.html">Contribution statistics</a></li>
        </ul>
      
    </nav>

</div>


  <nav class="footer navbar navbar-expand-lg navbar-light bg-light justify-content-end">
  <ul class="nav">
    <li class="nav-item">
      <a class="nav-link active" href="https://github.com/leanprover-community/leanprover-community.github.io/blob/lean4/templates/tips_and_tricks.md">Suggest edits to this page on GitHub</a>
    </li>
  </ul>
  </nav>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"></script>
    <script src="https://leanprover-community.github.io//js/bootstrap.min.js"></script>
    
  </body>
</html>
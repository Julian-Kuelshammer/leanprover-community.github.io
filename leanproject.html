<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="https://leanprover-community.github.io//css/lean.css" >
  <link rel="shortcut icon" href="https://leanprover-community.github.io//img/favicon.ico">
  <link rel="search" type="application/opensearchdescription+xml" title="mathlib docs" href="https://leanprover-community.github.io//opensearch.xml">
<link href="https://fonts.googleapis.com/css2?family=Merriweather&family=Open+Sans&family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet">
    

	<script>
                function buildShortcutsForStructures(names) {
                        const o = {}
                        names.forEach(name => o[name] = `\\mathbb\{${name}\}`)
                        return o
                }
		MathJax = {
			  tex: {
                                  macros: {
                                          ...buildShortcutsForStructures(["R", "Q", "Z", "N", "C"]),
                                  },
				      inlineMath: [['$', '$'], ['\\(', '\\)']]
				    },
		};
	</script>
	<script type="text/javascript" id="MathJax-script" async
		  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
	</script>

	<title>Using leanproject</title>
  </head>
  <body>
  <nav class="navbar navbar-expand-lg navbar-light bg-gradient-light d-md-none">
    <div class="d-flex flex-grow-1">
		<a class="navbar-brand" href="https://leanprover-community.github.io/index.html">Lean Community
    </a>
    </div>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
  </nav>

<div id="mainbox">

  <main>
    <div class="alert alert-info">
      <p>
      We are currently updating the Lean community website to describe working with Lean 4,
      but most of the information you will find here today still describes Lean 3.
      </p>
      <p>
      Pull requests updating this page for Lean 4 are very welcome.
      There is a link at the bottom of this page.
      </p>
      <p>
      Please visit <a href="https://leanprover.zulipchat.com">the leanprover zulip</a>
      and ask for whatever help you need during this transitional period!
      </p>
      <p>
      The website for Lean 3 has been <a href="https://leanprover-community.github.io/lean3/">archived</a>.
      If you need to link to Lean 3 specific resources please link there.
      </p>
    </div>

    
<h1 id="using-leanproject" class="markdown-heading">Using leanproject <a class="hover-link" href="#using-leanproject">#</a></h1>
<h2 id="basic-usage" class="markdown-heading">Basic usage <a class="hover-link" href="#basic-usage">#</a></h2>
<p>Everything is done using the <code>leanproject</code> command-line tool. You can
use <code>leanproject --help</code> to get the list of available commands and
options.</p>
<p><code>leanproject</code> only supports Lean 3. If you are using Lean 4, the information
on this page is not relevant.</p>
<h3 id="getting-an-existing-lean-3-project" class="markdown-heading">Getting an existing Lean 3 project <a class="hover-link" href="#getting-an-existing-lean-3-project">#</a></h3>
<p>The command to fetch an existing project from GitHub and make sure it
includes a copy of mathlib ready to go is <code>leanproject get name</code> where
name is either a git url, such as <code>https://github.com/leanprover-community/tutorials.git</code>
or <code>git@github.com:leanprover-community/tutorials.git</code>, or a GitHub project
identifier such as <code>leanprover-community/tutorials</code>. The organization
name defaults to <code>leanprover-community</code> so the simplest way get the tutorials
project is to run:</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code>leanproject get tutorials
</code></pre></div>
</div>

<p>You can specify a git branch name <code>my_branch</code> by appending
<code>:my_branch</code> at the end of the specified name (without space).
By default this branch should be an existing branch.
Use <code>leanproject get -b project_name:branch_name</code> to get
the project <code>project_name</code> and then create a branch <code>branch_name</code>
and start working on it.
You can also specify a target directory name as a second argument to the
command.</p>
<h3 id="creating-a-new-project" class="markdown-heading">Creating a new project <a class="hover-link" href="#creating-a-new-project">#</a></h3>
<p>You can create a project in a new folder <code>my_project</code> by running:</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code>leanproject new my_project
</code></pre></div>
</div>

<p>If you omit the argument, the project will be created directly inside
the current folder. This new project will be using the latest version of
Lean compatible with mathlib, and include a pre-built mathlib.</p>
<h3 id="building-a-project" class="markdown-heading">Building a project <a class="hover-link" href="#building-a-project">#</a></h3>
<p>Only mathlib itself comes with pre-built olean files. In order to build
oleans in a project (which is needed for every non-trivial project in
order to get decent interactive Lean speed), you can use:</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code>leanproject build
</code></pre></div>
</div>

<h3 id="getting-mathlib-oleans" class="markdown-heading">Getting mathlib oleans <a class="hover-link" href="#getting-mathlib-oleans">#</a></h3>
<p>In an existing project <em>depending on</em> mathlib
(for mathlib itself, use <code>leanproject get-cache</code>, see below), you can
run:</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code>leanproject get-mathlib-cache
</code></pre></div>
</div>

<p>to download a compiled mathlib at the commit currently specified in the
project <code>leanpkg.toml</code> (see the next section if you want to update this
commit and get the latest mathlib).</p>
<p>If you already have an existing project and you want to upgrade it then your can use</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code>leanproject pull
</code></pre></div>
</div>

<p>to run <code>git pull</code> and then get mathlib olean files. If the relevant git remote
is not called <code>origin</code> then you can indicate its name as in
<code>leanproject pull my_remote</code>.</p>
<p>If you have Lean 3 in VS Code open, you should restart Lean by opening the
command palette with <code>ctrl</code>+<code>p</code> (<code>cmd</code>+<code>p</code> on macOS) and running the
&quot;Lean: Restart server&quot; command.</p>
<h3 id="upgrading-mathlib" class="markdown-heading">Upgrading mathlib <a class="hover-link" href="#upgrading-mathlib">#</a></h3>
<p>In an existing project depending on mathlib, you can upgrade to the
latest mathlib version by running:</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code>leanproject upgrade-mathlib
</code></pre></div>
</div>

<p>This can be abbreviated to <code>leanproject up</code>.
By default, this will update the version of Lean 3 used by this project to
match the latest version compatible with mathlib. You can forbid such an
upgrade by using <code>leanproject --no-lean-upgrade upgrade-mathlib</code>.</p>
<p>Note that when working in a shared repository, after pushing the changes made
to <code>leanproject.toml</code> by this command, collaborators will need to run
<code>get-mathlib-cache</code> as described above.</p>
<p>If you have Lean 3 in VS Code open, you should restart Lean by opening the
command palette with <code>ctrl</code>+<code>p</code> (<code>cmd</code>+<code>p</code> on macOS) and running the
&quot;Lean: Restart server&quot; command.</p>
<h2 id="advanced-usage" class="markdown-heading">Advanced usage <a class="hover-link" href="#advanced-usage">#</a></h2>
<h3 id="adding-mathlib-to-an-existing-project" class="markdown-heading">Adding mathlib to an existing project <a class="hover-link" href="#adding-mathlib-to-an-existing-project">#</a></h3>
<p>If you already have a Lean project but it doesn&#x27;t use mathlib yet, you
can go to the project folder and run:</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code>leanproject add-mathlib
</code></pre></div>
</div>

<p>By default, this will update the version of Lean 3 used by this project to
match the latest version compatible with mathlib. You can forbid such an
upgrade by using <code>leanproject --no-lean-upgrade add-mathlib</code>.</p>
<h3 id="project-olean-cache" class="markdown-heading">Project olean cache <a class="hover-link" href="#project-olean-cache">#</a></h3>
<p>In any Lean 3 project (including mathlib itself), it can be useful to store and
retrieve olean files, especially if the project has several git branches.
Storing oleans is done by:</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code>leanproject mk-cache
</code></pre></div>
</div>

<p>while retrieving them is done by:</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code>leanproject get-cache
</code></pre></div>
</div>

<h4 id="creating-caches" class="markdown-heading">Creating caches <a class="hover-link" href="#creating-caches">#</a></h4>
<p>Note that while olean files are indeed the primary target here, <code>mk-cache</code>
actually stores everything from the <code>src</code> and <code>test</code> folders of the current
project. Since <code>mk-cache</code> uses the current git revision as the key to the
cache, it will refuse to run if your repository is dirty.</p>
<p>If the project is mathlib itself, the caches will be stored in
<code>$HOME/.mathlib/</code>. Otherwise, they will be stored in a folder <code>_cache</code> inside
the project top-level folder. They are named after the corresponding git
commit hash.</p>
<p>The <code>--force</code> option can be used to overwrite existing cache for the current
git revision.</p>
<p>Note that the Mathlib github repository will automatically create caches for
any commits pushed to it, so it is often unnecessary to use <code>mk-cache</code>.</p>
<h4 id="retrieving-caches" class="markdown-heading">Retrieving caches <a class="hover-link" href="#retrieving-caches">#</a></h4>
<p>When using <code>get-cache</code> inside the mathlib project, the local cache in
<code>$HOME/.mathlib/</code> will be searched first, before trying to download it.
You can force download by running
<code>leanproject --force-download get-cache</code>. This <code>--force-download</code> option
can also be used with the <code>upgrade-mathlib</code> command.</p>
<p>Frequently a cache is not available for the current commit in a Lean3 project;
typically due to new commits having been made on top of the one that a cache
was built from. In this situation, <code>get-cache</code> will fail, but show which
commits do have available caches:</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code><span class="bp">$</span> <span class="n">leanproject</span> <span class="n">get</span><span class="bp">-</span><span class="n">cache</span>
<span class="n">Looking</span> <span class="n">for</span> <span class="n">my_project</span> <span class="n">oleans</span> <span class="n">for</span> <span class="mi">3</span><span class="n">b19aed</span>
  <span class="n">locally...</span>
<span class="n">No</span> <span class="n">cache</span> <span class="n">available</span> <span class="n">for</span> <span class="n">revision</span> <span class="mi">3</span><span class="n">b19aed</span>
<span class="n">Looking</span> <span class="n">for</span> <span class="n">my_project</span> <span class="n">oleans</span> <span class="n">for</span> <span class="n">cf40a75</span>
  <span class="n">locally...</span>
  <span class="n">Found</span> <span class="kn">local</span> <span class="n">my_project</span> <span class="n">oleans</span>
<span class="n">No</span> <span class="n">cache</span> <span class="n">was</span> <span class="n">available</span> <span class="n">for</span> <span class="mi">3</span><span class="n">b19aed.</span> <span class="n">A</span> <span class="n">cache</span> <span class="n">was</span> <span class="n">found</span> <span class="n">for</span> <span class="n">the</span> <span class="n">ancestor</span> <span class="n">cf40a75.</span>
<span class="n">To</span> <span class="n">see</span> <span class="n">the</span> <span class="n">intermediate</span> <span class="n">commits</span><span class="o">,</span> <span class="n">run</span><span class="o">:</span>
  <span class="n">git</span> <span class="n">log</span> <span class="c1">--graph 3b19aed cf40a75^!</span>
<span class="n">Run</span> <span class="bp">`</span><span class="n">leanproject</span> <span class="n">get</span><span class="bp">-</span><span class="n">cache</span> <span class="c1">--rev` on one of the available commits above.</span>
</code></pre></div>
</div>

<p>In this scenario, running <code>leanproject get-cache --rev cf40a75</code> will fetch an
older cache which will be partially valid. Another option is just to run
<code>leanproject get-cache --fallback=download-first</code> which will automatically use
the first cache found for a parent commit.</p>
<p>If you have Lean 3 in VS Code open, you should restart Lean by opening the
command palette with <code>ctrl</code>+<code>p</code> (<code>cmd</code>+<code>p</code> on macOS) and running the
&quot;Lean: Restart server&quot; command.</p>
<h3 id="import-graphs" class="markdown-heading">Import graphs <a class="hover-link" href="#import-graphs">#</a></h3>
<p>If you want to generate a graph file showing your project import
structure, you can run:</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code>leanproject import-graph my_graph_file_name.suffix
</code></pre></div>
</div>

<p>where the suffix will determine the output format. It must be either
<code>dot</code> or <code>graphml</code> or <code>gexf</code>, (or <code>pdf</code>, <code>svg</code> or <code>png</code> if
<a href="https://www.graphviz.org/">graphviz</a> is installed).
If you want to restrict the graph to files leading to a certain file
<code>my_subproject/my_file.lean</code> then you can run:</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code>leanproject import-graph --to my_subproject.my_file my_graph_file_name.suffix
</code></pre></div>
</div>

<p>Dually, if you want to see all files using <code>my_subproject/my_file.lean</code>
then you can run:</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code>leanproject import-graph --from my_subproject.my_file my_graph_file_name.suffix
</code></pre></div>
</div>

<p>Combining <code>--to</code> and <code>--from</code> is possible.</p>
<h3 id="reducing-imports" class="markdown-heading">Reducing imports <a class="hover-link" href="#reducing-imports">#</a></h3>
<p>When adding imports to a file incrementally it is easy to end up with a long list
of imports where some imports include others transitively.
<code>leanproject</code> can be used to print a list of removable imports using the command</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code>leanproject reduce-imports lean.module.name
</code></pre></div>
</div>

<p>by adding the optional tag <code>--sed</code> a sed script will be produced instead that will
remove the unneeded lines for you when the script is executed.
Calling this command with no module argument will print removable imports in the
entire project.</p>
<h3 id="git-hooks" class="markdown-heading">Git hooks <a class="hover-link" href="#git-hooks">#</a></h3>
<p>If you want leanproject to fetch olean caches after each <code>git checkout</code>,
and make olean caches after each <code>git commit</code> in the current project,
you can run:</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code>leanproject hooks
</code></pre></div>
</div>

<p>Beware this will overwrite any <code>post-checkout</code> or <code>post-commit</code> file you
might have in your project <code>.git/hooks</code>.</p>
<h3 id="cache-download-url-handling" class="markdown-heading">Cache download url handling <a class="hover-link" href="#cache-download-url-handling">#</a></h3>
<p>By default, leanproject will try to find mathlib olean files hosted on an
Azure server. You permanently override the base url it uses by running:</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code>leanproject set-url my_url
</code></pre></div>
</div>

<p>so that leanproject will look for caches at
<code>my_url/relevant_git_hash.tar.gz</code>. You can override this base url
for one invocation using <code>leanproject --from-url my_url ...</code>
(where <code>...</code> denotes a command and its arguments).</p>
<h3 id="global-mathlib-install" class="markdown-heading">Global mathlib install <a class="hover-link" href="#global-mathlib-install">#</a></h3>
<p>If you want to use mathlib outside of a Lean 3 project, you can run:</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code>leanproject global-install
</code></pre></div>
</div>

<p>This will put a pre-compiled mathlib inside <code>$HOME/.lean</code>, the user-wide
Lean project whose dependencies can be used by lean files outside
projects. You can upgrade this project using:</p>
<div class="codehilite"><div class="codehilite"><pre><span></span><code>leanproject global-upgrade
</code></pre></div>
</div>

<p>This is generally discouraged, as this can lead to trouble if you end up
working with Lean 3 projects that depend on different versions of Lean 3 /
mathlib.</p>
<h2 id="troubleshooting" class="markdown-heading">Troubleshooting <a class="hover-link" href="#troubleshooting">#</a></h2>
<p>If <code>leanproject</code> ends with a mysterious error message, you can run it
using the <code>--debug</code> flag, e.g. <code>leanproject --debug new my_project</code>.
It will then probably output a python trace that you&#x27;ll be able to paste
in a GitHub issue or on <a href="https://leanprover.zulipchat.com/">Zulip</a>.</p>

  </main>

    <nav id="navbar" class="d-md-block bg-light sidebar collapse navbar-light pb-4">
      <div class="d-none d-md-block mt-4"><a class="navbar-brand" href="https://leanprover-community.github.io/index.html">Lean Community</a></div>
      
        <h6 class="sidebar-heading mt-4">Community</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover.zulipchat.com/">Zulip chat</a></li>
        
          <li class="nav-item col-12"><a href="https://github.com/leanprover-community/mathlib4">GitHub</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/blog">Blog</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/meet.html">Community information</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/teams.html">Teams</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/papers.html">Papers about Lean</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/lean_projects.html">Projects using Lean</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/events.html">Events</a></li>
        </ul>
      
        <h6 class="sidebar-heading mt-4">Installation</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/get_started.html">Get started</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/install/debian.html">Debian/Ubuntu installation</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/install/linux.html">Generic Linux installation</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/install/macos.html">MacOS installation</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/install/windows.html">Windows installation</a></li>
        
          <li class="nav-item col-12"><a href="https://lean.math.hhu.de/">Online version (no installation)</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/leanproject.html">Using leanproject</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/toolchain.html">The Lean toolchain</a></li>
        </ul>
      
        <h6 class="sidebar-heading mt-4">Documentation</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/learn.html">Learning resources (start here)</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/mathlib4_docs">API documentation</a></li>
        
          <li class="nav-item col-12"><a href="https://mathlib-changelog.vercel.app/">Changelog</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/extras/calc.html">Calc mode</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/extras/conv.html">Conv mode</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/extras/simp.html">Simplifier</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/extras/tactic_writing.html">Tactic writing tutorial</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/extras/well_founded_recursion.html">Well-founded recursion</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/mwe.html">About MWEs</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/glossary.html">Glossary</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/tips_and_tricks.html">Tips and tricks</a></li>
        </ul>
      
        <h6 class="sidebar-heading mt-4">Library overviews</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/mathlib-overview.html">Library overview</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/undergrad.html">Undergraduate maths</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/100.html">Wiedijk's 100 theorems</a></li>
        </ul>
      
        <h6 class="sidebar-heading mt-4">Theory docs</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/theories/category_theory.html">Category theory</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/theories/linear_algebra.html">Linear algebra</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/theories/naturals.html">Natural numbers</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/theories/sets.html">Sets and set-like objects</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/theories/topology.html">Topology</a></li>
        </ul>
      
        <h6 class="sidebar-heading mt-4">Contributing</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/contribute/index.html">Pull request lifecycle</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/contribute/naming.html">Naming conventions</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/contribute/style.html">Code style guideline</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/contribute/doc.html">Documentation style</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/ci.html">CI for 3rd party projects</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/mathlib_stats.html">Contribution statistics</a></li>
        </ul>
      
    </nav>

</div>


  <nav class="footer navbar navbar-expand-lg navbar-light bg-light justify-content-end">
  <ul class="nav">
    <li class="nav-item">
      <a class="nav-link active" href="https://github.com/leanprover-community/leanprover-community.github.io/blob/lean4/templates/leanproject.md">Suggest edits to this page on GitHub</a>
    </li>
  </ul>
  </nav>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"></script>
    <script src="https://leanprover-community.github.io//js/bootstrap.min.js"></script>
    
  </body>
</html>